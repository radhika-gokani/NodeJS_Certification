<!DOCTYPE html>
<html lang="en">

    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
   <title>ChatApp</title>  
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Pacifico" rel="stylesheet">
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/black/pace-theme-minimal.min.css" />
         <script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
       
        <script src="https://cdnjs.cloudflare.com/ajax/libs/audiojs/1.0.1/audio.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/audiojs/1.0.1/audio.cmd.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.nicescroll/3.6.8-fix/jquery.nicescroll.min.js"></script>
        </script>
    <style>
     ::-webkit-scrollbar {
    width: 0px;
	z-index:0;}
       body
        {
            background: #FFDE7D;
            font-family: 'Raleway', sans-serif;
        }
        
        div,input
        {
            outline: none;
            border: none;
        }
        .container
        {
            margin: 0 auto;
            width:100%; 
            max-width: 1000px;
           
        }
        #chatWindow
        {
            height: 400px;
            position: relative;
           top:5px;
            left:2px;
            overflow: scroll;
          
        }
        #mainWrapper
        {
              display: none;  
              overflow:auto;
        }
        #chatWrapper
        {
            
            vertical-align: bottom;
            background: #F8F3D4;
            padding:auto;
             box-shadow:0 0 10px black inset;
            display: block;
             z-index: 1;
                 overflow: hidden;
        }
        .msgcontent
        {
           
            padding: 20px 20px;
            z-index: 0;
            display:block;
            text-overflow: break-word;
            border-radius: 20px;
            
        }
        #userWrapper
        {
            
    
            background:#f4f4f4;
            padding: 10px;
            width:150px;
            display: block;
            height: auto;
            position:relative;
            bottom: 0px;
            top:10px;
            
        }
        #namesWrapper
        {
           
          
            background: #f4f4f4;
            padding: 10px;
            position: relative;
            top: 200px;
            width: 100%;
            
        }
        input
        {
            height: 50px;
            font-size: 18px;
            padding: 10px;
        }
        #messageForm
        {
            
            top: 500x;
            width:100%;
          
        }
     .username
        {
            width: 100%;
            max-width: 750px;
            float: left;
             
           
        }
        .jumbotron
        {
            background: #F6416C;
            overflow:auto;
            border-radius: 0px;
           
            
        }
        .jumbo
        {
             transition: all 0.2s;
        }
        input[type="submit"]
        {
            background: rgb(98, 87, 114);
            color: white;
            padding: 20;
            border-radius: 5px;
            width: 100px;
            height: 50px;
        }
        input[type="submit"]:hover
        {
             background: rgba(98, 87, 114,0.7);
        }
    </style>
    <body>
       
       <div class="container">
         <center><div id="namesWrapper" class="jumbotron" style="background:#00B8A9;">
                <h1 style="font-family: 'Pacifico', cursive;color:black;">Chatroom      </h1>
                <p>Create Username</p>
                <div id="error"></div>
                <form id="usernameForm">
                    <input type="text" id="username" >
                    <input type="submit" value="Submit">  
                </form>
            </div>
            </center>
            <div id="mainWrapper" class="jumbotron jumbo" >
                 <form>
              
                <input style="float:right;"type="submit" value="Logout"></form>
                <h1 style="font-family: 'Pacifico', cursive;color:white;">Chatroom </h1>    <h2 align="center" id="currentuser" style="padding:20px 10px;background:#FFDE7D" align="right"> </h2><div style="width:100%:height:60px;overflow:hiddenbox-shadow:0 0 10px black;">
                <center><div id="typingk" style="z-index:1;display:none;position:absolute; height:40px;left:15%;background:#F9ED69;color:black;width:70%;transition:all 0.8s;"><h4 align="center">typing...</h4></div></center></div> 
              
                <div id="chatWrapper">
                
                    <div id="chatWindow">
               
                
                     
                    </div>
                    
                   
                </div>
                 <form id="messageForm">
                            <input  id="message" placeholder="say something..." class="username" style="z-index:1;"><center> <input style="z-index:1;" type="submit" value="Say It!">  </center>
                           
                        </form>
                <center>  <div id="userWrapper">
                        <div id="users"></div>
                    </div></center>
              
            </div>
        </div>
        
        
        <script  src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.2/socket.io.js"></script>
      <!--  <script src="https://github.com/dmauro/Keypress/blob/development/keypress-2.1.4.min.js"></script>-->
<script>
    $(document).ready(function() {  
    $('html').niceScroll();
});
</script>
        <script>
  audiojs.events.ready(function() {
    var as = audiojs.createAll();
  });
</script>
        <script>
            
            function scrollbackdown(){
               
                    var elem = document.getElementById('chatWindow');
                    elem.scrollTop = elem.scrollHeight;
                   
            };
            
            
            $(function(){
               var socket = io.connect('http://localhost:3000');
                var $messageForm = $('#messageForm');
                var $message = $('#message');
                var $chat = $('#chatWindow');
                var $usernameForm = $('#usernameForm');
                var $users = $('#users');
                var $username = $('#username');
                var $error = $('#error');
                var $currentuser =$('#currentuser');
               
                 $('#username').focus();
                $('.jumbotron').addClass('animated bounceIn');
                
               
               
                $usernameForm.submit(function(e){
                   
                    e.preventDefault();
                     
                    socket.emit('new user',$username.val(),function(data){
                        if(data)
                            {
                                $('#namesWrapper').hide();
                                $('#mainWrapper').show();
                                $currentuser.html($username.val());
                              
                                $('#message').focus();
                            }
                        else
                            {
                                $error.html("Username cannot empty be or already taken!");
                                 $username.addClass("animated shake");
                            } 
                       
                    });
                    $username.removeClass("animated shake");
                        $uname=$('#username').val();
                                 
                });
                
                socket.on('usernames',function(data){
                    var html = '';
                     var ulen=data.usernames.length;
                    for(i=0;i<data.usernames.length;i++)
                        {
                            html+=data.usernames[i]+' has joined <br>';
                            $('#users').addClass('animated tada');
                           
                        }
                    
                    //$chat.append('<br><h4 align="center">'+data.usernames[data.usernames.length-1]+' has joined<br><small>At '+data.hour+':'+data.minute+'</small></h4><br>');
                     scrollbackdown();
                    
                   if (ulen!=data.usernames.length)
                       {
                           $('#users').addClass('animated tada');
                       }    
                    $users.html(html); 
                });
                 socket.on('joinu',function(data){
                      var d = new Date();
                     
                      d = d.toLocaleString('en-US', { hour: 'numeric',minute:'numeric', hour12: true });
                      $chat.append('<br><br><h4 align="center" id="notify_join">'+data+' has joined chat<br><small>'+d+'</small></h4>');
                     
                      $('#notify_join').addClass('animated tada');
                      scrollbackdown();
                });
                 $('#notify_join').addClass('animated tada');
                
                socket.on('leaveu',function(data){
                    var d = new Date();
                    
                    d = d.toLocaleString('en-US', { hour: 'numeric',minute:'numeric', hour12: true });
             
                     $chat.append('<br><br><h4 align="center" id="notify_leave">'+data+' has left chat<br><small>'+d+'</small></h4>');
                    $('#notify').addClass('animated tada');
                     scrollbackdown();
                });
                 $('#notify_leave').removeClass('animated tada');
                
                
                
               
                $messageForm.submit(function(e){
                    e.preventDefault();
                    socket.emit('send message',$message.val());
                    $message.val('');
                    
                });
                //typing user
                
               
                var fl=0;
                
               
                    $("#message").keypress(function(){
                          fl=1;
                        socket.emit('keypressed',{fl:fl,uname:$currentuser.val()});
                        
                    });
                
                 $("#message").keyup(function(){
                        fl=0;
                        socket.emit('keypressed',fl);
                });
               
                socket.on('typing',function(data){
                    if (data==1)
                        {
                           $('#typingk').show();
                            //$('.jumbo').css("background-color", "#F07B3F");
                            // scrollbackdown();
                        }
                    else 
                        {
                             $('#typingk').hide();
                            // scrollbackdown();
                          //  $('.jumbo').css("background-color", "#F6416C");
                           
                        }
              
                });
               
                    
             
                socket.on('new message',function(data){
                    var d = new Date();
                    
                    d = d.toLocaleString('en-US', { hour: 'numeric',minute:'numeric', hour12: true });
             
                                         
                    

                    var audio = new Audio('https://notificationsounds.com/standard-ringtones/here-i-am-449/download/mp3');
                    var audio2 = new Audio('https://notificationsounds.com/message-tones/all-eyes-on-me-465/download/mp3');
                        
                    if(data.user==$username.val())
                        {
                            data.user = "You ";
                            
                            
                            $chat.append('<br><br><br><div class="msgcontent animated bounceInRight" style="float:right; background: #00B8A9;font-size:18px;position:relative;right:8px;">  '+data.msg+': <strong>'+data.user+'</strong><br><small>'+d+'</small></div><br><br><br>');  
                            audio2.play();
                            scrollbackdown();
                        }
                    else
                        {
                    $chat.append('<br><br><br><div class="msgcontent animated bounceInLeft" style="float:left;position:relative;left:2px;background:#625772;color:white;font-size:18px;"><strong>'+data.user+'</strong> :  '+data.msg+'<br><small>'+d+'</small></div><br><br><br>');
                            audio.play();
                            scrollbackdown();
                             window.navigator.vibrate(200);
                          
                        }
                    $('#message').focus();
                   
                    
                });
            });
        </script>
     </body>
</html>